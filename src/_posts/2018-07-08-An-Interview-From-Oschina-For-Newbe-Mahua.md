---
layout: post
title: 回答开源中国关于Newbe.Mahua的采访稿
categories: Docs Mahua
tags: Mahua SDK
mahua: true
---

# 回答开源中国关于Newbe.Mahua的采访稿

## 先介绍一下 Newbe.Mahua.Framework 框架的基本信息，并举例说明一下它的使用场景。

Newbe.Mahua.Framework 是一套提供了与多个QQ机器人平台进行对接的插件开发SDK。框架采用C#语言实现，为开发者提供了统一的开发接口，避免了开发者需要针对不同QQ机器人平台进行定制化对接的繁杂工作。开发者可以使用本框架开发属于机器的QQ机器人平台插件，实现QQ消息智能回复，群成员管理等一系列功能。

以上是本框架能够实现的业务需求，然而这并非Newbe真正的目的。

入行以来，Newbe试图通过书籍、互联网去了解，去接触开发知识。然而实践过程中发现，实际上人与人之间的交流沟通，更加能够丰富自身的知识储备。为此，Newbe建立了这个项目，并且争取在项目过程中间，将使用到的工具、过程和方法说明说白，让刚刚入行的.Net程序员能够学会例如设计模式、单元测试、开发工具等一些成为中级开发人员所必要的技能。总结来说，建立围绕.Net开发的交流社群，才是Newbe开发此项目的目的。

## 我们知道微信平台下是不允许出现第三方机器人工具的，那 Newbe.Mahua.Framework 这个框架在 QQ 生态上是否被允许？还是说这是不同的概念？给读者说明一下。

QQ机器人平台通常来说是逆向QQ的通信协议实现机器人的功能，逆向通信协议并利用通信协议实现相关功能的做法，在法律上是否支持，这点Newbe不能给出解释，需要相关从业人员才能解释。

而本框架实质上时通过调用互联网上存在的一些QQ机器人平台接口实现相关功能的。因此本框架仅仅被定义为一个"插件开发的SDK"。插件必须依附于这些QQ机器人平台才能运行。同时，这些QQ机器人平台所提供的SDK并非只用如此一种，通过其他的开发语言也同样能够实现相应的业务需求。

因此，QQ 是否允许 Newbe.Mahua.Framework 这样的插件SDK的存在，似乎不是很重要。QQ更加关注的应该是这些QQ机器人平台。

结合项目立意，Newbe之所以会选择这样一个业务需求场景开发一个SDK，实际上为了初学.Net开发的开发者更好的学习.Net开发知识。

按照Newbe的了解，现代业务系统开发中，BS和CS架构仍然是无法逃开的系统结构形式。因此,.Net开发人员在入行之后，一般都会接触BS或CS架构的开发，然而这两者通常来说，都需要一定的界面制作技术。而这些内容是重要的，但Newbe认为，在如今技术更新迭代如此快速的时代，"学会开发哲学，学会如何学习"才是能够成为不被淘汰的技术人员所应该具备的素质。因此，Newbe选择了QQ机器人插件开发，这样一个相对不要求界面制作技术的领域，让参与项目的开发者，能够在解决"如何一套接口对接多个平台"、"如何制作简单的IDE插件"、"如何实现非托管代码与托管代码的调用"等一系列开发问题上学会这其中的"工具、过程和方法"。

## 另外，抛开微信和 QQ，放到整个大背景下来看，我们知道目前市面上针对一些软件，其实有相关的一些第三方产品对软件进行接入，以实现某些功能，这里涉及到软件有提供官方 API 与未提供 API 的情况，相关情况具体是怎样的呢？

本SDK开发出来的插件需要提托与机器人平台才能够正常运行。因此，在API能力上也受限于特定的机器人平台。同时SDK为了通用性，也对这些API进行的整理和封装，因此API并非与机器人平台完全一致。具体的API公开情况，可以进入项目Readme中进行查看。

## 同时可以结合一下这个：Newbe.Mahua.Framework 是已经在其它机器人平台的基础上进一步封装，只提供具体业务相关的能力？是不是说它其实并没有切入到 QQ 底层，也就是上边说的切入 API 或者进行相关 HOOK ?

按照前文所述，本SDK并没有切入QQ底层，只是实现了与多个机器人平台的对接。

## 这样的话对 Newbe.Mahua.Framework 的使用又有哪些限制呢？也就是说拿它来做些什么功能场景的时候会导致封杀？

Newbe认为，功能限制实质上包含两部分。一部分是法律限制，这点容易理解，开发出国家或地区法律所禁止的插件功能，这必然是会被封杀的。第二部分是技术性的限制，例如高频发送消息、消息内容异常等等，这些技术性限制没有明确说明，但随着腾讯公司的检测机制不断强大，技术性的限制也势必会越来越多。

## 目前市面上与 Newbe.Mahua.Framework 类似的项目有哪些，简单做一下对比，并说明 Newbe.Mahua.Framework 的优势如何？

作为一个SDK，市面上可用的项目数不胜数。相比于这些项目，Newbe认为本项目的亮点主要可以归结为两点：一、项目通过模块化的方式，实现了一套接口对接多个不同平台的能力，很大程度上简化了开发者的工作。二、项目除了本身带来的业务价值，更重要的是建立的.Net交流社群，分析学习项目实现中的"工具、过程和方法"更是本项目的亮点。

## 具体介绍一下该项目的架构是怎么样的？并具体介绍整个系统的运作流程，以及架构中每个组件提供的能力。（配图说明）

项目现在为开发者提供了类库、构建工具、IDE插件和文档四大块内容。项目的总体架构如下图所示：

![项目结构](https://raw.githubusercontent.com/newbe36524/Newbe.Mahua.Framework/master/i/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

图中的Newbe.Mahua便是本SDK的核心内容，开发者可以基于本SDK之上开发实现自己业务需求的机器人平台插件。

Newbe.Mahua.Ipc 则是其中的基于本SDK开发的一个插件，提供其他进程能够跨进程调用机器人平台的能力。

若将Newbe.Mahua这一层展开来看，则包含下图所示内容：

![Newbe.Mahua包结构]({{ site.baseurl }}/assets/i/20180708-001.png)

其中各个模块的简介如下：

- Newbe.Mahua

  提供了接口层能力，本SDK提供的所有接口都定义于该类库中，开发者可以通过调用该层接口实现业务需求。

- Newbe.Mahua.PluginLoader

  SDK实现的核心所在。主要实现了几块内容：一、通过模块化加载实现了针对不同平台实现层加载不通运行时类库的能力。二、通过AppDomain实现了插件的托管代码与机器人平台的非托管代码进行通信的能力。

- Newbe.Mahua.*

  平台实现层，针对不同的机器人平台，实现了接口层的接口。

- Newbe.Mahua.Tools.Psake

  构建工具包，通过[Newbe.Build.Psake](https://gitee.com/yks/Newbe.Common/blob/master/src/Newbe.Build.Psake/README.md)实现了开发阶段的插件打包功能，减少开发难度。

- Newbe.Mahua.ApiExtensions

  平台Api拓展类库，允许SDK的使用者添加或者替换接口的实现。从而实现一些原平台不具备或实现不佳的API。

- Newbe.Mahua.Administration

  提供一个多平台统一的管理中心界面。可以进行挂载菜单和界面的管理中心。开发者可以通过实现特定的接口来实现一个跨平台的统一管理界面。

  除了以上所描述的类库和工具,本框架还包含以下这些内容：

  - [Visual Studio 插件，提供了一些常用的开发模板。](https://marketplace.visualstudio.com/items?itemName=Newbe36524.NewbeMahuaVsExtensions)
  - [样例代码与特性帮助](http://www.newbe.pro/docs/mahua/2018/04/21/Newbe-Mahua-Navigations.html)

## 开发该框架涉及到了哪些具体工作内容

作为开源项目，开发过程中我们一直坚持"社区主导，社区优先"的原则，每个版本迭代，一般会按照社区所反馈的issue的优先级，订立相关的里程碑。确保每一个里程碑的发布，都能给社区一个新特性的反馈和若干优化项。其过程之中就包含但不限于以下具体的工作：

1. 回复社区反馈
2. 确定版本迭代计划
3. 开发主体框架
4. 开发IDE插件
5. 编写开发文档
6. 发布版本

## 介绍一下目前使用该框架的成功案例。

一般使用该SDK开发的插件，都不会公开出来。但是从相关的机器人平台上，可以看到相应的开放插件，读者可以自行前往相应的机器人平台官网进行了解。

## 介绍一下开发过程中遇到的印象深刻的困难/坑以及解决方案。

最为深刻的便是解决"如何在插件中实现程序集重定向功能"的问题。

程序集重定向，是指在.Net开发过程中，由于程序集的版本依赖版本不同，而需要进行重定向到特定版本的功能，这是.Net开发的原生能力。举个简单的例子，A程序集依赖了C程序集的10版本，B程序集依赖了C程序集的8版本，而在插件当中需要依赖A/B/C三个程序集，因此需要对C程序集的版本配置重定向。往常，可以直接在程序集的App.config文件中配置即可。

然而，机器人平台都是非托管程序，因此无法直接加载App.config文件，因此需要另辟蹊径。经过社区的激烈讨论，其中一位名为月落的社区开发者提出了"使用单独的AppDomain来单独加载插件程序集"的方案，经过了社区的一致认可。

过程当中，社区开发者的热情和努力，是最为领我感动的。

## 我们看到最近该项目发布的新版本，功能强大，这个项目还是比较活跃的，接下来的 roadmap 是怎么样的？

按照社区目前的计划，该项目后续的roadmap大致如下：

- 适配更多的机器人平台
- 编写项目实现技术细节的说明文档
- 完善 Newbe.Mahua.Ipc
