!function(e,t,n){"use strict";var o=e.hljs,a=e.marked,i="AMWikiUrlEncode",r=function(){this.$e={win:n(e),view:n("#view"),title:n("title"),contentsTitle:n("#contentsTitle")},this.data={pageWidth:0},this.initUrlEncode(),this.initHashEvent()};r.prototype.initUrlEncode=function(){localStorage[i]?"utf8"!=localStorage[i]&&"gbk"!=localStorage[i]&&(localStorage[i]="utf8"):localStorage[i]="utf8",delete localStorage.urlEcode},r.prototype.initHashEvent=function(){var e=this;this.data.pageWidth=this.$e.win.width(),this.$e.win.on("resize",function(){e.data.pageWidth=e.$e.win.width()}),this.$e.win.on("hashchange",function(){var t=location.hash.split("#")[1];e.data.pageWidth<=720&&e.$e.view.find("h1,h2,h3").each(function(o,a){var i=n(a),r=i.text().replace(/\s+/g,"");t==r&&e.$e.win.scrollTop(i.offset().top-55)})})},r.prototype._tramsformLinkText=function(e){return e.replace(/^\s+|\s+$/g,"").replace(/'/g,"&#39;").replace(/"/g,"&#34;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},r.prototype._setTitlesAnchor=function(){var e=this,t=null,o="",a="";return location.hash&&location.hash.length>1&&(o=location.hash.split("#")[1]),t=e.$e.view.find("h1,h2,h3"),t.each(function(t,i){var r=n(i),l=e._tramsformLinkText(r.text()),c=l.replace(/&#34;/g,"");r.is("h2")?a+="1. ["+l+"](#"+c+' "'+c+'")\n':r.is("h3")&&(a+="\t1. ["+l+"](#"+c+' "'+c+'")\n'),r.prepend('<a class="anchor" href="#{title}" name="{title}"><svg><use xlink:href="#icon:linkAnchor"></use></svg></a>'.replace(/{title}/g,c)),o==r.text().replace(/"/g,"")&&(e.data.pageWidth<=720?e.$e.win.scrollTop(r.offset().top-55):e.$e.win.scrollTop(r.offset().top))}),0==a.indexOf("\t")&&(a="1. &#12288;\n"+a),a},r.prototype.createFootnote=function(e){var t=[],o=/\[\^([ a-zA-Z\d]+)]/g,a=/\[\^([ a-zA-Z\d]+)]: ?([\S\s]+?)(?=\[\^(?:[ a-zA-Z\d]+)]|\n\n|$)/g,i=n.trim(n("#template\\:footnote").text()).split(/[\r\n]+\s*/g),r="";if(e=e.replace(a,function(e,n,o,a){var i="";return o=o.replace(/"(.*?)"\s*$/,function(e,t){return i=t,""}),t.push({index:a,note:n,content:o,title:i,used:!1}),""}),e=e.replace(o,function(e,n){for(var o,a=0;o=t[a];a++)if(o.note==n)return o.used=!0,i[0].replace(/{{index}}/g,a+1+"").replace("{{title}}",o.title);var r=t.push({index:0,note:n,content:n,used:!0});return i[0].replace(/{{index}}/g,r+"")}),t.length>=1){for(var l,c=0;l=t[c];c++)l.used?r+=i[2].replace("{{index}}",c+1).replace("{{content}}",l.content).replace("{{back}}",i[4].replace("{{index}}",c+1)):r+=i[3].replace("{{content}}",l.content);r=i[1].replace("{{list}}",r)}return e+r},r.prototype.setJSCommentDisable=function(e){var t=n('<div class="lang-off-js-comment">\u6ce8<i>/</i></div>');t.on("click",function(){var t=n(this);t.hasClass("on")?(t.removeClass("on"),e.find(".hljs-comment").show()):(t.addClass("on"),e.find(".hljs-comment").hide())}),e.prepend(t)},r.prototype.createFlowChart=function(e){var t=e.text();e.text("");var n="flowChart"+parseInt(500*Math.random());e.attr("id",n),flowchart.parse(t).drawSVG(n,{"line-width":1.3,"line-length":55,"line-color":"#666","text-margin":10,"font-size":12,font:"normal","font-family":"Helvetica","font-weight":"normal","font-color":"black","element-color":"#888",fill:"#fff","yes-text":"\u662f","no-text":"\u5426","arrow-end":"block-wide-long",symbols:{},flowstate:{}})},r.prototype.encodeUrl=function(e,t){var n="",o=[];return"normal"==t?"utf8"==localStorage[i]?n="library/"+encodeURI(e):"gbk"==localStorage[i]&&(o=e.split("/"),n="library/"+GBK.encode(o[0]),n+=o[1]?"/"+GBK.encode(o[1]):"",n+=o[2]?"/"+GBK.encode(o[2]):""):"reverse"==t&&("utf8"==localStorage[i]?(o=e.split("/"),n="library/"+GBK.encode(o[0]),n+=o[1]?"/"+GBK.encode(o[1]):"",n+=o[2]?"/"+GBK.encode(o[2]):""):"gbk"==localStorage[i]&&(n="library/"+encodeURI(e))),n+=".md?t="+(new Date).getTime()},r.prototype.renderDoc=function(e){var t=this,i="";this.cleanView(),e=this.createFootnote(e),i=a(e).replace(/\[(TOC|MENU)]/g,'<blockquote class="markdown-contents"></blockquote>'),this.$e.view.html(i).find("pre code").each(function(e,a){var i=n(a),r=i.attr("class")||"";r.indexOf("lang-flow")>=0?t.createFlowChart(i):r.indexOf("lang")>=0&&o.highlightBlock(a),r=i.attr("class")||"",r.indexOf("javascript")>=0&&t.setJSCommentDisable(i)});var r=this.$e.view.find("h1").eq(0).text();this.$e.title.text(r),this.$e.contentsTitle.text(r).attr("href","#"+r.replace(/"/g,""));var l=this._setTitlesAnchor();n(".markdown-contents").html(a(l))},r.prototype.getDoc=function(e,t){var o={type:"get",url:e,dataType:"text"};n.ajax(o).done(function(e){if(/^\s*<!(DOCTYPE|doctype)/.test(e))return t("fail");t("done",e)}).fail(function(){t("fail")})},r.prototype.loadPage=function(e,t){var n=this,o=this.encodeUrl(e,"normal");this.getDoc(o,function(o,a){if("fail"==o){var r=n.encodeUrl(e,"reverse");n.getDoc(r,function(e){"fail"==e?t&&t("error"):"done"==e&&(localStorage[i]="utf8"==localStorage[i]?"gbk":"utf8",t&&t("success",a))})}else"done"==o&&t&&t("success",a)})},r.prototype.cleanView=function(){this.$e.view.find(".lang-off-js-comment").off("click"),this.$e.view.html("")},e.AWDocs=r}(window,document,jQuery);